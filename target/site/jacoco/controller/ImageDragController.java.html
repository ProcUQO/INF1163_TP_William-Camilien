<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="fr"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ImageDragController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">INF1163_TP_Cami_William</a> &gt; <a href="index.source.html" class="el_package">controller</a> &gt; <span class="el_source">ImageDragController.java</span></div><h1>ImageDragController.java</h1><pre class="source lang-java linenums">package controller;

import command.TranslateCommand;
import model.ImageModel;
import model.Perspective;
import model.PerspectiveMemento;
import java.awt.Point;
import java.awt.event.*;

/**********
 * Cette class nous permet d'obtenir les valeur pour créé la translation de notre image selon le
 * drag de la souris dans l'écran.
 ***********/
public class ImageDragController extends Controller implements MouseListener, MouseMotionListener {
    private Perspective perspective;
    private Point initialMousePoint;  // position initiale de la souris
    private PerspectiveMemento initialState;  // état initial de la perspective

    public ImageDragController(ImageModel model, Perspective p) {
<span class="nc" id="L20">        super(model);</span>
<span class="nc" id="L21">        this.perspective = p;</span>
<span class="nc" id="L22">    }</span>

    @Override
    public void mousePressed(MouseEvent e) {
<span class="nc" id="L26">        initialMousePoint = e.getPoint();</span>
<span class="nc" id="L27">        initialState = perspective.createMemento();  // Sauvegarde l'état initial pour qu'on fasse undo redo plus tard :)</span>
<span class="nc" id="L28">    }</span>

    // Ce n'est pas le vrai mouvement qu'on applique, seulement temporaire, c'est pour éviter de faire un état de undo à chaque frame de déplacement
    @Override
    public void mouseDragged(MouseEvent e) {
        // Calcule la position temporaire (c'est fluide)
<span class="nc" id="L34">        int dx = e.getPoint().x - initialMousePoint.x;</span>
<span class="nc" id="L35">        int dy = e.getPoint().y - initialMousePoint.y;</span>
        // Met à jour la perspective (TEMPORAIRE, j'insiste, on enregistre pas)
<span class="nc" id="L37">        perspective.setTranslation(initialState.getTranslationX() + dx, initialState.getTranslationY() + dy);</span>
<span class="nc" id="L38">    }</span>

    @Override
    public void mouseReleased(MouseEvent e) {
        // On fait le déplacement réel
<span class="nc" id="L43">        int totalDx = e.getPoint().x - initialMousePoint.x;</span>
<span class="nc" id="L44">        int totalDy = e.getPoint().y - initialMousePoint.y;</span>
        /* Restaure l'état initial (pour éviter le double déplacement)
         c'est une solution un peu weird mais, si tu regardes en mettant la ligne en
         commentaire, tu verras que ça empêche de faire un double saut (d'appliquer
         la distance de déplacement deux fois, avec le drag.)*/
<span class="nc" id="L49">        perspective.restoreFromMemento(initialState);</span>
        // Applique le déplacement total une fois
<span class="nc" id="L51">        executeCommand(new TranslateCommand(perspective, totalDx, totalDy));</span>
        // Réinitialise les champs
<span class="nc" id="L53">        initialState = null;</span>
<span class="nc" id="L54">        initialMousePoint = null;</span>
<span class="nc" id="L55">    }</span>

    // Méthodes inutilisées
<span class="nc" id="L58">    @Override public void mouseMoved(MouseEvent e) {}</span>
<span class="nc" id="L59">    @Override public void mouseEntered(MouseEvent e) {}</span>
<span class="nc" id="L60">    @Override public void mouseExited(MouseEvent e) {}</span>
<span class="nc" id="L61">    @Override public void mouseClicked(MouseEvent e) {}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>