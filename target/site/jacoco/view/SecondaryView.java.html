<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="fr"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SecondaryView.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">INF1163_TP_Cami_William</a> &gt; <a href="index.source.html" class="el_package">view</a> &gt; <span class="el_source">SecondaryView.java</span></div><h1>SecondaryView.java</h1><pre class="source lang-java linenums">package view;

import model.ImageModel;
import model.Perspective;
import javax.swing.*;
import java.awt.*;
import java.awt.image.BufferedImage;

/*
Similaire à mainview, mais avec un carré rouge qui représente la position de mainview.
 */
public class SecondaryView extends JPanel implements Observer {
    private final ImageModel model;
    private final Perspective mainPerspective;
    private final MainView mainView;

<span class="nc" id="L17">    public SecondaryView(ImageModel model, Perspective mainP, Perspective miniP, MainView mainView) {</span>
<span class="nc" id="L18">        this.model = model;</span>
<span class="nc" id="L19">        this.mainPerspective = mainP;</span>
<span class="nc" id="L20">        this.mainView = mainView;</span>
<span class="nc" id="L21">        mainP.addObserver(this);</span>
<span class="nc" id="L22">        miniP.addObserver(this);</span>
<span class="nc" id="L23">        setPreferredSize(new Dimension(220, 220));</span>
<span class="nc" id="L24">        setBackground(Color.DARK_GRAY);</span>
<span class="nc" id="L25">    }</span>

    @Override
    public void update() {
<span class="nc" id="L29">        repaint();</span>
<span class="nc" id="L30">    }</span>

    @Override
    protected void paintComponent(Graphics g) {
<span class="nc" id="L34">        super.paintComponent(g);</span>
<span class="nc" id="L35">        BufferedImage img = model.getImage();</span>
<span class="nc bnc" id="L36" title="All 2 branches missed.">        if (img == null) return;</span>

<span class="nc" id="L38">        Graphics2D g2 = (Graphics2D) g;</span>
<span class="nc" id="L39">        int w = getWidth();</span>
<span class="nc" id="L40">        int h = getHeight();</span>
<span class="nc" id="L41">        int imgW = img.getWidth();</span>
<span class="nc" id="L42">        int imgH = img.getHeight();</span>

        // 1) Scaler l'image en secondaire (plus petit que le main :) )
<span class="nc" id="L45">        double scaleMini = Math.min((double) w / imgW, (double) h / imgH);</span>
<span class="nc" id="L46">        int scaledW = (int) (imgW * scaleMini);</span>
<span class="nc" id="L47">        int scaledH = (int) (imgH * scaleMini);</span>
<span class="nc" id="L48">        int offsetX = (w - scaledW) / 2;</span>
<span class="nc" id="L49">        int offsetY = (h - scaledH) / 2;</span>
<span class="nc" id="L50">        g2.drawImage(img, offsetX, offsetY, scaledW, scaledH, this);</span>

        // le rectangle rouge (l'aspect principal du secondaryview)
<span class="nc" id="L53">        double mainScale = mainPerspective.getScale();</span>
<span class="nc" id="L54">        int tx = mainPerspective.getTranslationX();</span>
<span class="nc" id="L55">        int ty = mainPerspective.getTranslationY();</span>

        // Taille de la MainView
<span class="nc" id="L58">        int mainViewWidth = mainView.getWidth();</span>
<span class="nc" id="L59">        int mainViewHeight = mainView.getHeight();</span>

        // Position du coin supérieur gauche de la zone visible dans l'image originale
<span class="nc" id="L62">        double visibleX = (-tx) / mainScale;</span>
<span class="nc" id="L63">        double visibleY = (-ty) / mainScale;</span>

        // Taille de la zone visible dans l'image originale
<span class="nc" id="L66">        double viewW = mainViewWidth / mainScale;</span>
<span class="nc" id="L67">        double viewH = mainViewHeight / mainScale;</span>

        // Ratios avec le réel (j'ai essayé parent.getWidth mais c'était pas réellement accurate)
<span class="nc" id="L70">        double ratioX = scaledW / (double) imgW;</span>
<span class="nc" id="L71">        double ratioY = scaledH / (double) imgH;</span>

        // convertit la position visible dans l’espace secondaire
<span class="nc" id="L74">        int rectX = offsetX + (int) (visibleX * ratioX);</span>
<span class="nc" id="L75">        int rectY = offsetY + (int) (visibleY * ratioY);</span>

        // convertit la taille visible dans l’espace secondaire
<span class="nc" id="L78">        int rectW = (int) (viewW * ratioX);</span>
<span class="nc" id="L79">        int rectH = (int) (viewH * ratioY);</span>

        // j'ai fais que le rectangle rouge n'est pas remplit, mais ça se modifie facilement.
<span class="nc" id="L82">        g2.setColor(Color.RED);</span>
<span class="nc" id="L83">        g2.setStroke(new BasicStroke(2f));</span>
<span class="nc" id="L84">        g2.drawRect(rectX, rectY, rectW, rectH);</span>
<span class="nc" id="L85">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>